<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Konversi Masehi ke Hijriyah (Urfi)</title>
</head>

<body>

<h3>Konversi Tanggal Masehi → Hijriyah (Hisab Urfi)</h3>

<label>Tanggal Masehi:</label><br>
<input type="number" id="tgl" placeholder="Tanggal" value="20">
<input type="number" id="bln" placeholder="Bulan" value="1">
<input type="number" id="thn" placeholder="Tahun" value="2026">
<br><br>

<button onclick="proses()">Konversi</button>

<hr>

<div id="hasil"></div>

<script>
// =====================
// FUNGSI MASEHI → JD
// =====================
function gregorianToJD(y, m, d) {
  if (m <= 2) {
    y -= 1;
    m += 12;
  }
  const A = Math.floor(y / 100);
  const B = 2 - A + Math.floor(A / 4);

  return Math.floor(365.25 * (y + 4716)) +
         Math.floor(30.6001 * (m + 1)) +
         d + B - 1524.5;
}

// =====================
// MASEHI → HIJRI URFI
// =====================
function gregorianToHijri(y, m, d) {
  const jd = gregorianToJD(y, m, d);
  const hijriEpoch = 1948439.5;

  const days = Math.floor(jd - hijriEpoch);
  const year = Math.floor((30 * days + 10646) / 10631);

  const yearStart =
    hijriEpoch +
    354 * (year - 1) +
    Math.floor((3 + 11 * year) / 30);

  let dayOfYear = Math.floor(jd - yearStart) + 1;

  let monthLengths = [
    30, 29, 30, 29, 30, 29,
    30, 29, 30, 29, 30, 29
  ];

  // tahun kabisat urfi
  const isLeap = ((11 * year + 14) % 30) < 11;
  if (isLeap) monthLengths[11] = 30;

  let month = 0;
  while (dayOfYear > monthLengths[month]) {
    dayOfYear -= monthLengths[month];
    month++;
  }

  return {
    day: dayOfYear,
    month: month + 1,
    year: year
  };
}

// =====================
// PROSES
// =====================
function proses() {
  const d = parseInt(document.getElementById("tgl").value);
  const m = parseInt(document.getElementById("bln").value);
  const y = parseInt(document.getElementById("thn").value);

  const h = gregorianToHijri(y, m, d);

  const namaBulan = [
    "Muharram","Shafar","Rabiul Awal","Rabiul Akhir",
    "Jumadil Awal","Jumadil Akhir","Rajab","Sya'ban",
    "Ramadhan","Syawal","Dzulqa'dah","Dzulhijjah"
  ];

  document.getElementById("hasil").innerHTML = `
    <b>Hasil Konversi:</b><br><br>
    ${d}-${m}-${y} M<br>
    ⇩<br>
    <b>${h.day} ${namaBulan[h.month-1]} ${h.year} H</b>
  `;
}
</script>

</body>
</html>